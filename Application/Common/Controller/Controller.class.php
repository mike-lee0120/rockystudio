<?php /* lingyun.net ç‰ˆæƒæ‰€æœ‰ ç›—ç‰ˆå¿…ç©¶
-- enphp : https://git.oschina.net/mz/mzphp2
 */   namespace Common\Controller;class Controller extends \Think\Controller{protected function display($ï='',$ùó='',$ê¹ˆ¹='',$­ØÅ='',$Ç¤–ÀÙ=''){if(!is_file($ï)){$í=C('TMPL_FILE_DEPR');if('' ==$ï){$ï=request()->controller().$í.request()->action();}elseif(!0x001===strpos($ï,$í)){$ï=request()->controller().$í.$ï;}}else{$Ó¿Ë=$ï;“–®;}$Š=array();éª·ÍåÈíâ ¼ä¥ÚÒº¯Ë´–ûûëÚáÇŞ­Š®ƒôÙ»ÂÀ„°¤¥í‰ËÈÛ;²‡·ŒÌ;$Ôğ=C('CURRENT_THEME');Ô„Ÿ©ÄëÈ®ïí¾ƒ„ì‘;$Ô=$this->view->get('is_builder');²É©ÜŸ›µæòº‡œşòä®âÓíæØÛøçËƒ½ÅÁš÷ŒÃÕ«Şòá;İìò‹÷¢;ÍƒœÁèË¥¼ºŒ––…ıâ‰¼©Ê;if($Ôğ){if(C('IS_MOBILE')){$¢×š÷='./Theme/' .$Ôğ.'/' .request()->module().'/';$ù='./Theme/' .$Ôğ.'/' .request()->module().'/Wap/';$Š['TMPL_PARSE_STRING']=C('TMPL_PARSE_STRING');if($Ô){$äÀÒ‚='./Theme/' .$Ôğ.'/Home/Wap/Public';if(is_dir($äÀÒ‚)){$Š['HOME_PUBLIC_LAYOUT']=$äÀÒ‚.'/layout.html';$Š['HOME_PUBLIC_MODAL']=$äÀÒ‚.'/modal.html';$Š['TMPL_PARSE_STRING']['__HOME_IMG__']=C('TOP_HOME_PAGE').ltrim($äÀÒ‚,'.').'/img';$Š['TMPL_PARSE_STRING']['__HOME_CSS__']=C('TOP_HOME_PAGE').ltrim($äÀÒ‚,'.').'/css';$Š['TMPL_PARSE_STRING']['__HOME_JS__']=C('TOP_HOME_PAGE').ltrim($äÀÒ‚,'.').'/js';$Š['TMPL_PARSE_STRING']['__HOME_LIBS__']=C('TOP_HOME_PAGE').ltrim($äÀÒ‚,'.').'/libs';$ŸĞ¿ê='./Theme/' .$Ôğ.'/' .C('DEFAULT_MODULE').'/Wap/Public';if(is_dir($ŸĞ¿ê)){$Š['DEFAULT_PUBLIC_LAYOUT']=$ŸĞ¿ê.'/layout.html';$Š['TMPL_PARSE_STRING']['__DEFAULT_IMG__']=$Š['TOP_HOME_PAGE'].ltrim($ŸĞ¿ê,'.').'/img';$Š['TMPL_PARSE_STRING']['__DEFAULT_CSS__']=$Š['TOP_HOME_PAGE'].ltrim($ŸĞ¿ê,'.').'/css';$Š['TMPL_PARSE_STRING']['__DEFAULT_JS__']=$Š['TOP_HOME_PAGE'].ltrim($ŸĞ¿ê,'.').'/js';$Š['TMPL_PARSE_STRING']['__DEFAULT_LIBS__']=$Š['TOP_HOME_PAGE'].ltrim($ŸĞ¿ê,'.').'/libs';}if(MODULE_MARK==='Home'){$ü¥ƒ“¼='./Theme/' .$Ôğ.'/Home/Wap/Builder';if(is_dir($ü¥ƒ“¼)){$Š['LISTBUILDER_LAYOUT']=$ü¥ƒ“¼.'/listbuilder.html';$Š['FORMBUILDER_LAYOUT']=$ü¥ƒ“¼.'/formbuilder.html';}if(is_dir('./Theme/' .$Ôğ.'/User/Wap')){$Š['USER_CENTER_SIDE']='./Theme/' .$Ôğ.'/User/Wap/Index/side.html';$Š['USER_CENTER_INFO']='./Theme/' .$Ôğ.'/User/Wap/Index/info.html';$Š['USER_HOME_INFO']='./Theme/' .$Ôğ.'/User/Wap/Index/home_info.html';if(is_dir('./Theme/' .$Ôğ.'/User/Wap/Builder')){$Š['USER_CENTER_FORM']='./Theme/' .$Ôğ.'/User/Wap/Builder/form.html';$Š['USER_CENTER_LIST']='./Theme/' .$Ôğ.'/User/Wap/Builder/list.html';if('list' ===$Ô){$ï=$Š['USER_CENTER_LIST'];}if('form' ===$Ô){$ï=$Š['USER_CENTER_FORM'];}}}}if(MODULE_MARK==='Home'){$Š['VIEW_PATH']=$ù;}else if(MODULE_MARK==='Admin' && request()->module()!=='Admin'){if(is_dir($ù.'Admin/')){$Š['VIEW_PATH']=$ù.'Admin/';}}$’='./Theme/' .$Ôğ.'/' .request()->module().'/Wap/Public';if(is_dir($’)){$Š['TMPL_PARSE_STRING']['__IMG__']=C('TOP_HOME_PAGE').ltrim($’,'.').'/img';$Š['TMPL_PARSE_STRING']['__CSS__']=C('TOP_HOME_PAGE').ltrim($’,'.').'/css';$Š['TMPL_PARSE_STRING']['__JS__']=C('TOP_HOME_PAGE').ltrim($’,'.').'/js';$Š['TMPL_PARSE_STRING']['__LIBS__']=C('TOP_HOME_PAGE').ltrim($’,'.').'/libs';}}}else{if(!$Ó¿Ë){$Ó¿Ë='./Theme/' .$Ôğ.'/' .request()->module().'/Wap/' .$ï.'.html';if(!is_file($Ó¿Ë)&& is_dir($¢×š÷)&& !defined('IS_ADDON')){$Î='./Theme/' .$Ôğ.'/Home/Public';if(is_dir($Î)){$Š['HOME_PUBLIC_LAYOUT']=$Î.'/layout.html';$Š['HOME_PUBLIC_MODAL']=$Î.'/modal.html';$Š['TMPL_PARSE_STRING']['__HOME_IMG__']=C('TOP_HOME_PAGE').ltrim($Î,'.').'/img';$Š['TMPL_PARSE_STRING']['__HOME_CSS__']=C('TOP_HOME_PAGE').ltrim($Î,'.').'/css';$Š['TMPL_PARSE_STRING']['__HOME_JS__']=C('TOP_HOME_PAGE').ltrim($Î,'.').'/js';$Š['TMPL_PARSE_STRING']['__HOME_LIBS__']=C('TOP_HOME_PAGE').ltrim($Î,'.').'/libs';$İ¦ë='./Theme/' .$Ôğ.'/' .C('DEFAULT_MODULE').'/Public';if(is_dir($İ¦ë)){$Š['DEFAULT_PUBLIC_LAYOUT']=$İ¦ë.'/layout.html';$Š['TMPL_PARSE_STRING']['__DEFAULT_IMG__']=$Š['TOP_HOME_PAGE'].ltrim($İ¦ë,'.').'/img';$Š['TMPL_PARSE_STRING']['__DEFAULT_CSS__']=$Š['TOP_HOME_PAGE'].ltrim($İ¦ë,'.').'/css';$Š['TMPL_PARSE_STRING']['__DEFAULT_JS__']=$Š['TOP_HOME_PAGE'].ltrim($İ¦ë,'.').'/js';$Š['TMPL_PARSE_STRING']['__DEFAULT_LIBS__']=$Š['TOP_HOME_PAGE'].ltrim($İ¦ë,'.').'/libs';}if(MODULE_MARK==='Home'){$ü¥ƒ“¼='./Theme/' .$Ôğ.'/Home/Builder';if(is_dir($ü¥ƒ“¼)){$Š['LISTBUILDER_LAYOUT']=$ü¥ƒ“¼.'/listbuilder.html';$Š['FORMBUILDER_LAYOUT']=$ü¥ƒ“¼.'/formbuilder.html';}if(is_dir('./Theme/' .$Ôğ.'/User')){$Š['USER_CENTER_SIDE']='./Theme/' .$Ôğ.'/User/Index/side.html';$Š['USER_CENTER_INFO']='./Theme/' .$Ôğ.'/User/Index/info.html';$Š['USER_HOME_INFO']='./Theme/' .$Ôğ.'/User/Index/home_info.html';}}if(MODULE_MARK==='Home'){$Š['VIEW_PATH']=$¢×š÷;}else if(MODULE_MARK==='Admin' && request()->module()!=='Admin'){if(is_dir($ù.'Admin/')){$Š['VIEW_PATH']=$¢×š÷.'Admin/';}}$’='./Theme/' .$Ôğ.'/' .request()->module().'/Public';if(is_dir($’)){if(is_file($’.'/layout.html')&& MODULE_MARK==='Home'){$Š['HOME_PUBLIC_LAYOUT']=$’.'/layout.html';}$Š['TMPL_PARSE_STRING']['__IMG__']=C('TOP_HOME_PAGE').ltrim($’,'.').'/img';$Š['TMPL_PARSE_STRING']['__CSS__']=C('TOP_HOME_PAGE').ltrim($’,'.').'/css';»ÏŸû¢¡ŒøÁÜ¹­Ò·ÒÕÊŞİ°ñ­ùÏÓå†•Ê¿ĞšŞÍ½;$Š['TMPL_PARSE_STRING']['__JS__']=C('TOP_HOME_PAGE').ltrim($’,'.').'/js';·ñïŠ©ÃàôÔÀÒ…²€ƒÔæ‰ê±È»Ì¨Š;¡²Ÿƒ¨îîè‡¶±™¦¶»»óÙõÆÖŸ‹ßÀòöÎ×Úø­üµëŸ¤;$Š['TMPL_PARSE_STRING']['__LIBS__']=C('TOP_HOME_PAGE').ltrim($’,'.').'/libs';}}}}}}}else{if(C('IS_MOBILE')){$¢×š÷=APP_DIR.request()->module().'/View/';$ù=APP_DIR.request()->module().'/View/Wap/';$Š['TMPL_PARSE_STRING']=C('TMPL_PARSE_STRING');if($Ô){$äÀÒ‚=APP_DIR.'Home/View/Wap/Public';if(is_dir($äÀÒ‚)){$Š['HOME_PUBLIC_LAYOUT']=$äÀÒ‚.'/layout.html';$Š['HOME_PUBLIC_MODAL']=$äÀÒ‚.'/modal.html';$Š['TMPL_PARSE_STRING']['__HOME_IMG__']=C('TOP_HOME_PAGE').ltrim($äÀÒ‚,'.').'/img';$Š['TMPL_PARSE_STRING']['__HOME_CSS__']=C('TOP_HOME_PAGE').ltrim($äÀÒ‚,'.').'/css';$Š['TMPL_PARSE_STRING']['__HOME_JS__']=C('TOP_HOME_PAGE').ltrim($äÀÒ‚,'.').'/js';$Š['TMPL_PARSE_STRING']['__HOME_LIBS__']=C('TOP_HOME_PAGE').ltrim($äÀÒ‚,'.').'/libs';$ŸĞ¿ê=APP_DIR.C('DEFAULT_MODULE').'/View/Wap/Public';if(is_dir($ŸĞ¿ê)){$Š['DEFAULT_PUBLIC_LAYOUT']=$ŸĞ¿ê.'/layout.html';$Š['TMPL_PARSE_STRING']['__DEFAULT_IMG__']=$Š['TOP_HOME_PAGE'].ltrim($ŸĞ¿ê,'.').'/img';$Š['TMPL_PARSE_STRING']['__DEFAULT_CSS__']=$Š['TOP_HOME_PAGE'].ltrim($ŸĞ¿ê,'.').'/css';$Š['TMPL_PARSE_STRING']['__DEFAULT_JS__']=$Š['TOP_HOME_PAGE'].ltrim($ŸĞ¿ê,'.').'/js';$Š['TMPL_PARSE_STRING']['__DEFAULT_LIBS__']=$Š['TOP_HOME_PAGE'].ltrim($ŸĞ¿ê,'.').'/libs';}if(MODULE_MARK==='Home'){$ü¥ƒ“¼=APP_DIR.'/Home/View/Wap/Builder';if(is_dir($ü¥ƒ“¼)){$Š['LISTBUILDER_LAYOUT']=$ü¥ƒ“¼.'/listbuilder.html';$Š['FORMBUILDER_LAYOUT']=$ü¥ƒ“¼.'/formbuilder.html';}if(is_dir(APP_DIR.'/User/View/Wap')){$Š['USER_CENTER_SIDE']=APP_DIR.'User/View/Wap/Index/side.html';$Š['USER_CENTER_INFO']=APP_DIR.'User/View/Wap/Index/info.html';$Š['USER_HOME_INFO']=APP_DIR.'User/View/Wap/Index/home_info.html';if(is_dir(APP_DIR.'/User/View/Wap/Builder')){$Š['USER_CENTER_FORM']=APP_DIR.'User/View/Wap/Builder/form.html';$Š['USER_CENTER_LIST']=APP_DIR.'User/View/Wap/Builder/list.html';if('list' ===$Ô){$ï=$Š['USER_CENTER_LIST'];}if('form' ===$Ô){$ï=$Š['USER_CENTER_FORM'];}}}}if(MODULE_MARK==='Home'){$Š['VIEW_PATH']=$ù;}else if(MODULE_MARK==='Admin' && request()->module()!=='Admin'){if(is_dir($ù.'Admin/')){$Š['VIEW_PATH']=$ù.'Admin/';}}$’=APP_DIR.request()->module().'/View/Wap/Public';œ´İ¦Ş¡ˆÓöÈ§ûû¨ü€ıã‰è–Ò¤ãú¯î¥”²’°çï×Æ’ß›‰©Â†¦ëƒ¦éç;‰ú…üÕûÄ¬œĞÜÃ…¬œß»–íè“£‡€Ã¬£–êíŸ;if(is_dir($’)){$Š['TMPL_PARSE_STRING']['__IMG__']=C('TOP_HOME_PAGE').ltrim($’,'.').'/img';$Š['TMPL_PARSE_STRING']['__CSS__']=C('TOP_HOME_PAGE').ltrim($’,'.').'/css';$Š['TMPL_PARSE_STRING']['__JS__']=C('TOP_HOME_PAGE').ltrim($’,'.').'/js';$Š['TMPL_PARSE_STRING']['__LIBS__']=C('TOP_HOME_PAGE').ltrim($’,'.').'/libs';}}}else{if(!$Ó¿Ë){$Ó¿Ë=APP_DIR.request()->module().'/View/Wap/' .$ï.'.html';if(!is_file($Ó¿Ë)&& !defined('IS_ADDON')){$Î=APP_DIR.'Home/View/Public';if(is_dir($Î)){$Š['HOME_PUBLIC_LAYOUT']=$Î.'/layout.html';$Š['HOME_PUBLIC_MODAL']=$Î.'/modal.html';$Š['TMPL_PARSE_STRING']['__HOME_IMG__']=C('TOP_HOME_PAGE').ltrim($Î,'.').'/img';$Š['TMPL_PARSE_STRING']['__HOME_CSS__']=C('TOP_HOME_PAGE').ltrim($Î,'.').'/css';$Š['TMPL_PARSE_STRING']['__HOME_JS__']=C('TOP_HOME_PAGE').ltrim($Î,'.').'/js';$Š['TMPL_PARSE_STRING']['__HOME_LIBS__']=C('TOP_HOME_PAGE').ltrim($Î,'.').'/libs';$İ¦ë=APP_DIR.C('DEFAULT_MODULE').'/View/Public';if(is_dir($İ¦ë)){$Š['DEFAULT_PUBLIC_LAYOUT']=$İ¦ë.'/layout.html';$Š['TMPL_PARSE_STRING']['__DEFAULT_IMG__']=$Š['TOP_HOME_PAGE'].ltrim($İ¦ë,'.').'/img';$Š['TMPL_PARSE_STRING']['__DEFAULT_CSS__']=$Š['TOP_HOME_PAGE'].ltrim($İ¦ë,'.').'/css';$Š['TMPL_PARSE_STRING']['__DEFAULT_JS__']=$Š['TOP_HOME_PAGE'].ltrim($İ¦ë,'.').'/js';$Š['TMPL_PARSE_STRING']['__DEFAULT_LIBS__']=$Š['TOP_HOME_PAGE'].ltrim($İ¦ë,'.').'/libs';}if(MODULE_MARK==='Home'){$Š['LISTBUILDER_LAYOUT']=BUILDER_DIR.'listbuilder.html';$Š['FORMBUILDER_LAYOUT']=BUILDER_DIR.'formbuilder.html';$Š['USER_CENTER_SIDE']=APP_DIR.'User/View/Index/side.html';$Š['USER_CENTER_INFO']=APP_DIR.'User/View/Index/info.html';$Š['USER_HOME_INFO']=APP_DIR.'User/View/Index/home_info.html';}if(MODULE_MARK==='Home'){$Š['VIEW_PATH']=$¢×š÷;}else if(MODULE_MARK==='Admin' && request()->module()!=='Admin'){if(is_dir($ù.'Admin/')){$Š['VIEW_PATH']=$¢×š÷.'Admin/';}}}if(is_file(APP_DIR.request()->module().'/View/Public/' .'layout.html')&& MODULE_MARK==='Home'){$Š['HOME_PUBLIC_LAYOUT']=APP_DIR.request()->module().'/View/Public/' .'layout.html';}}}}}}C($Š);÷âş;½ğáê²÷êöü˜“ÜÓ©Ê½½îÄ½³;$¤¼†·=array();Åµ»¦ÑÅĞ•ËöÏë¸Î¿·Ò¸›Ñàíöó¯Œ;´éë;™”ùêÙÊ€¦Â‚õáí®±®æ„æ‚ÖÈğÎçäıôÈ×ÇáëÂÌÆÌíĞÎã²½“ãëú;$¤¼†·['status']=0x001;¿œí„ÓøœåÁıÒ„Ê™’˜‡âçë–¥€ù‘úâäø£ç²†»ÀşØ¦ÁÖøÅ¢“×»›º£ˆĞÈ‰ËÚ…¯ÀşÓÂæ‡È¢;­•áÆ©¿šÓŠØ‘ùÏ®²øë‚â°Æê²;îŠÒèÏõü§±™âÕ¡´Ÿ«ú°°»¯„ı–‹Æ¹ÓµÃ™‰­é€ª‘²Ãôˆåª¨‘«£ÂÛŞòàÜŠì¤ÄÁ;$¤¼†·['name']='User';¾ó„ìŠå³³¥Î‡°§™«ÅèÙ;„²·…İÉ·¢¿;$ˆéè=D('Admin/Module')->where($¤¼†·)->getField('user_nav');$ˆéè=json_decode($ˆéè,!0);¤á÷Ã ìÇö®ÁªÔ‘²†¸Ë±ı´ŒÒ;if(isset($ˆéè['center'])){$ˆéè=$ˆéè['center'];}$¤¼†·=array();$¤¼†·['status']=0x001;ĞÒÉÚÀíŸƒ¡šˆïŸ»§¤šñÜ¼±Å›‡à±”¾£€öÉê¸¸‹»Ú¥ÄÊÄòé›äÆØ—ä³ì€å¾‰‚ÎÌº¹…Åôßëºª±»;î–†Ô¸ª·±í×Ÿ¶æ;$¤¼†·['name']=request()->module();¯›ÈÎÏµÎµ¶;$¹İÀ=D('Admin/Module')->where($¤¼†·)->getField('user_nav');Àóñô€ÅÆßÚ¶öàŒ°‹Ãâøœ‚°ƒ™–¬ÛĞçĞ’Û‘†Î‡‡•Íçï…ßĞ‘ÛÕóÕòö;$¹İÀ=json_decode($¹İÀ,!0);ïêËª–üæµ™½¹ûíÕ;if(isset($¹İÀ['main'])){$½¥ú=$¹İÀ['main'];}if(isset($¹İÀ['center'])){$Ú=$¹İÀ['center'];}if(C('DEFAULT_MODULE_LAYOUT')&& C('DEFAULT_PUBLIC_LAYOUT')&& is_file(C('DEFAULT_PUBLIC_LAYOUT'))){C('HOME_PUBLIC_LAYOUT',C('DEFAULT_PUBLIC_LAYOUT'));}if(!request()->isAjax()||(request()->isAjax()&& C('IS_API_HTML'))){$this->assign('meta_keywords',C('WEB_SITE_KEYWORD'));$this->assign('meta_description',C('WEB_SITE_DESCRIPTION'));$this->assign('_new_message',cookie('_new_message'));$this->assign('_user_auth',session('user_auth'));$this->assign('_user_nav_main',$ˆéè);$this->assign('_module_nav_main',$½¥ú);$this->assign('_module_nav_center',$Ú);$this->assign('_module_nav',$¹İÀ);$this->assign('_user_center_side',C('USER_CENTER_SIDE'));$this->assign('_user_center_info',C('USER_CENTER_INFO'));$this->assign('_user_home_info',C('USER_HOME_INFO'));$this->assign('_admin_public_layout',C('ADMIN_PUBLIC_LAYOUT'));$this->assign('_home_public_layout',C('HOME_PUBLIC_LAYOUT'));$this->assign('_home_public_modal',C('HOME_PUBLIC_MODAL'));$this->assign('_listbuilder_layout',C('LISTBUILDER_LAYOUT'));$this->assign('_formbuilder_layout',C('FORMBUILDER_LAYOUT'));if(MODULE_MARK=='Admin'){$this->assign('_info_layout',C('ADMIN_PUBLIC_LAYOUT'));}else{$this->assign('_info_layout',C('HOME_PUBLIC_LAYOUT'));}$this->assign('_page_name',strtolower(request()->module().'_' .request()->controller().'_' .request()->action()));$œ›=D('Admin/Module')->getFieldByName(request()->module(),'title');ñ”ÖüòÇè¾ò€¼ÙµÕ˜îÒ†Ä˜Äê“ÑÆÅíá±è½£ü•¡ğÜ‹°Ï‹ì©ÁÃÂ°–Èõ®àÁà¨ˆÏŠ¹¸Çİ¶Ü€¨º‹Ø;ÖÌ¥ö¼«;$this->assign('_current_module',$œ›);çé“Ü¿‡ÓÅüä;ŠöŠ¡À€ÏÎá’°Š›€•Õ¹Ü³ïº³™ô¾ò€Õ¹µ¯Ä¬;$this->assign('_nav_list_child',D('Admin/Nav')->getNavTreeChild());Ğ­‘Ğ–àØÍ¸çšŞß×‹¶åÈŸÏÜû;¶½œÉí§äí½º§›î˜Õ£±Ëâ¤Ì¸Ş‚ç£¯¢ŠÜÁÚùŒÈ¢ğ¶ß¬;}if(request()->isAjax()|| C('IS_API')){$ú›öĞ=array();if(C('IS_API_HTML')&& is_file($this->view->parseTemplate($ï))){$©¢=$this->fetch($ï);$ú›öĞ['html']=$©¢;}$ú›öĞ['data']=$this->view->get();$this->success('æ•°æ®è·å–æˆåŠŸ','',$ú›öĞ);­ìÃÑœåÜºÃ•½ªİßœ•¿ÉôºåìŒ¥–ªÇä•£“ƒçäŸÎÁÙ’àïÏŒÎ¯©ãîòÙªØÆ¶ıÜáÆÂöé;}else{$this->view->display($ï);»š ıô²ßäƒë³²•˜¢‰òÍá¹…à—æ§Úİ’°Øãìó„êè·ËÎº·ƒíÍœ×İºÈâ›ßÊÃº¨Õë‚¹Ù;}}public function setStatus($¾Åßö‘='',$±É=null){if('' ==$¾Åßö‘){$¾Åßö‘=request()->controller();}$ —=array_unique((array) I('ids',0));$°îİ=I('request.status');if(empty($ —)){$this->error('è¯·é€‰æ‹©è¦æ“ä½œçš„æ•°æ®');}$òÅ=D($¾Åßö‘);$½=$òÅ->getPk();‹õû¢ª™Ó¿—İŞËÍÇŸïŞ·‘‡ÃèçÔÈÓ—Â›£¹˜Åä²š¤É÷ƒ•ÆËµÔØ¦´‘¸»Õ;¯éš‰ßÙÏ¿Ğàîƒª¡¤ÂïÕ²ÍäÜóØ£û—­¾ıîç¨÷ÈƒÈ‰Ô©÷ØÔ™ü—‰ÒÊÖ¸§Ë‘ËÇ¨ø‡§‡õ;$ —=is_array($ —)?implode(',',$ —):$ —;$îØ[$½]=array('in',$ —);”ææ¬¬ÌŞÇğ©¿ô¿†ÀôÛšœ¬;if($±É===null){if(MODULE_MARK==='Home'){$±É=!0;}}if($±É){$îØ['uid']=array('eq',$this->is_login());}switch($°îİ){case 'forbid':$‰áÚâ=array('status' =>0);$this->editRow($¾Åßö‘,$‰áÚâ,$îØ,array('success' =>'ç¦ç”¨æˆåŠŸ','error' =>'ç¦ç”¨å¤±è´¥'));break;case 'resume':$‰áÚâ=array('status' =>0x001);$îØ=array_merge(array('status' =>0),$îØ);$this->editRow($¾Åßö‘,$‰áÚâ,$îØ,array('success' =>'å¯ç”¨æˆåŠŸ','error' =>'å¯ç”¨å¤±è´¥'));break;case 'recycle':if(in_array('pid',$òÅ->getDbFields())){$ôßÎ=$òÅ->where(array('pid' =>array('in',$ —)))->count();if($ôßÎ>0){$this->error('æ— æ³•åˆ é™¤ï¼Œå­˜åœ¨å­é¡¹ç›®ï¼');}}$‰áÚâ['status']=-0x001;ÕëÁ¢ıê§‡ñ;Ö÷©„Ä‰Ëµ²Œªò“ëçï†…€²Ù;ßÀØ¹ô›şòöá©ëÂ÷êö;$this->editRow($¾Åßö‘,$‰áÚâ,$îØ,array('success' =>'æˆåŠŸç§»è‡³å›æ”¶ç«™','error' =>'å›æ”¶å¤±è´¥'));¼â³¤ÓÃ¡ª»Ë¯€Ôû¶ˆˆàûœÍãŒÔèˆÃØ½•;ãâáÎŠèÁÙ÷ªº¸ƒó®”­‡‡±òÓªŞÊ¼Ÿ®‘„’òÒœÜ”öÔ¿²Ã¦¼Ø·êà¿ú’²;break;šú±ÉŒ¶Û€;case 'restore':$‰áÚâ=array('status' =>0x001);$îØ=array_merge(array('status' =>-0x001),$îØ);ğ²Ş£Á¢Êıû‚éÜÁäïô´­‡;ŒÜŸÈ©ÎÈşËşˆÓà„ğ®çı„Ñ‹Œ–äÉ«úêô¶Ş”şÉ½Î“¼š“ÄîôÈß¤±;™µïôµùî“˜ßÆ÷ƒˆšÎ‡–;$this->editRow($¾Åßö‘,$‰áÚâ,$îØ,array('success' =>'æ¢å¤æˆåŠŸ','error' =>'æ¢å¤å¤±è´¥'));“Öã‰‹’‘Ú»Ëóğ¼é§¶ØºÏ¸Ç¼‰â‹‘ùÜ‚íğØÒùãäŒ¿ ×³‘”¸Ëöó›°ôãìşÆ÷ÁÕ“¯Æë‚ÁĞçÍ‘ˆ¦ÅšºãÓ†ÚÇ¢Œ;é´;break;case 'delete':if(in_array('pid',$òÅ->getDbFields())){$ôßÎ=$òÅ->where(array('pid' =>array('in',$ —)))->count();if($ôßÎ>0){$this->error('æ— æ³•åˆ é™¤ï¼Œå­˜åœ¨å­é¡¹ç›®ï¼');}}$½ÎñÎ=$òÅ->where($îØ)->delete();ÎÂÑ ª ±³ÆöÎÚ¢ˆ¶ê«Ã©²¼ç‚¯·’÷šÒˆè–ÙŠÁù»ôÀ;if($½ÎñÎ){$this->success('åˆ é™¤æˆåŠŸï¼Œä¸å¯æ¢å¤ï¼');}else{$this->error('åˆ é™¤å¤±è´¥');}break;default:$this->error('å‚æ•°é”™è¯¯');break;æÊÆÒöŠû;ÈˆÒ—›²¯Ô¡;}}final protected function editRow($ã¬ö,$¾î,$’÷Ÿ,$Ñª){$Ñª=array_merge(array('success' =>'æ“ä½œæˆåŠŸï¼','error' =>'æ“ä½œå¤±è´¥ï¼','url' =>' ','ajax' =>request()->isAjax(),),(array) $Ñª);ßš£Ïª‹›ğİ“ûÚ¼Ã¿èºÛ¨ª’º¢±âôÜÍÁÃ­ÎŞÑŸ‰İ»ù»Îõ–ŒºÕõô± ;$ã¬ö=D($ã¬ö);õ½¸Ò‹ù—¹ÉõŒèşé¥ù¥óğ¼«“ö¡Å–ÂŠğ†€¯¾Ó»¹ëôƒ;®û¡¶Ï¹Ñßë‚´¦Òî¢ğàö»‡äÖ¬š»»‹¢”º¶ğîğÃÎÜÅ„êë×úÛúë¼ñ¨Ä×şğòº;áë“Û’ˆÍÎ‰ù;$œ¨˜=$ã¬ö->where($’÷Ÿ)->save($¾î);å³¹¥;÷ªëèî»Æ´¿±¡˜­ı“™º…Á€İÀğĞûÏÙß‰ÖØ´ÃÂ£ş‰Ø¾»úÖéøêƒ´ğÅ;if($œ¨˜!=!0x001){$this->success($Ñª['success'].$ã¬ö->getError(),$Ñª['url'],$Ñª['ajax']);}else{$this->error($Ñª['error'].$ã¬ö->getError(),$Ñª['url'],$Ñª['ajax']);}}protected function ajaxReturn($ŞóéâÖ,$Ğ¸×ã•='',$ëã¹õİ=0){if(is_login()&& !0===APP_DEMO&& $ŞóéâÖ['status']==0){$ŞóéâÖ['info']='æ¼”ç¤ºæ¨¡å¼å·²å…³é—­æ•°æ®åº“å†™å…¥åŠŸèƒ½';}$ŞóéâÖ['session_id']=session_id();if(empty($Ğ¸×ã•)){$Ğ¸×ã•=C('DEFAULT_AJAX_RETURN');}switch(strtoupper($Ğ¸×ã•)){case 'JSON':header('Content-Type:application/json; charset=utf-8');exit(json_encode($ŞóéâÖ,$ëã¹õİ));case 'XML':header('Content-Type:text/xml; charset=utf-8');exit(xml_encode($ŞóéâÖ));case 'JSONP':header('Content-Type:application/json; charset=utf-8');$öú=isset($_GET[C('VAR_JSONP_HANDLER')])?$_GET[C('VAR_JSONP_HANDLER')]:C('DEFAULT_JSONP_HANDLER');exit($öú.'(' .json_encode($ŞóéâÖ,$ëã¹õİ).');');case 'EVAL':header('Content-Type:text/html; charset=utf-8');exit($ŞóéâÖ);default:Hook::listen('ajax_return',$ŞóéâÖ);}}}